<!DOCTYPE html>
<html>

<head>
    <title>Merry Xmas!</title>
</head>

<body>
    <div id="app">
        <table>
            <tbody>
                <tr v-for="light in lights">
                    <td v-text="light.name"></td>
                    <td>
                        <button v-if="light.enabled" @click="command('disable_lights', [light.pin])">DISABLE</button>
                        <button v-else>ENABLE</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script>
        var app = new Vue({

            el: '#app',

            data: {
                ws: null,
                lights: [],
            },

            methods: {
                ws_update: function(event) {
                    this.lights = JSON.parse(event.data)
                },
                command(command, pins) {
                    this.ws.send(JSON.stringify({
                        'command': command,
                        'pins': pins,
                    }))
                    console.log(pins, command)
                }
            },

            created() {
                this.ws = new WebSocket("ws://127.0.0.1:5678/")
                this.ws.onmessage = this.ws_update
            }
        })
    </script>
</body>

</html>